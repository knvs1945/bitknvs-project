{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,GAAG,EAAE,IAAI,EAAuB,MAAM,aAAa,CAAA;AAE5D;;;GAGG;AACH,MAAM,OAAO,KAAK;IAChB,EAAE,CAAU;IACZ,SAAS,GAAY,KAAK,CAAA;IAE1B,YAAY,CAAW;QACrB,IAAI,CAAC,EAAE,GAAG,CAAC,CAAA;IACb,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,GAAW;QACf,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,2CAA2C;YAC3C,MAAM,IAAI,GAAG,IAAI,EAAE,GAAG,EAAE,EAAE,IAAI,GAAG,CAAA;YACjC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAA;YACrB,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,EAAE,CAAA;YACzB,IAAI,CAAC,EAAE,CAAC,KAAK,GAAG,KAAK,IAAI,EAAE;gBACzB,IAAI,CAAC,EAAE,CAAC,KAAK,GAAG,KAAK,CAAA;gBACrB,mDAAmD;gBACnD,8BAA8B;gBAC9B,IAAI,EAAE,KAAK,EAAE,CAAC,IAAI,CAAC,CAAA;gBACnB,MAAM,KAAK,EAAE,CAAA;YACf,CAAC,CAAA;QACH,CAAC;QACD,IAAI,EAAE,KAAK,EAAE,CAAC,GAAG,CAAC,CAAA;IACpB,CAAC;CACF;AAED;;GAEG;AACH,MAAM,CAAC,MAAM,MAAM,GAAqB,CAAC,CAAC,EAAE,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAA","sourcesContent":["import { cwd, proc, TapPlugin, TestBase } from '@tapjs/core'\n\n/**\n * Implementation class providing the {@link @tapjs/intercept!Chdir#chdir}\n * method\n */\nexport class Chdir {\n  #t: TestBase\n  #didOnEOF: boolean = false\n\n  constructor(t: TestBase) {\n    this.#t = t\n  }\n\n  /**\n   * Change the working directory, for the context of a single test.\n   */\n  chdir(dir: string): void {\n    if (!this.#didOnEOF) {\n      /* c8 ignore next - very rarely relevant */\n      const back = proc?.cwd?.() || cwd\n      this.#didOnEOF = true\n      const { onEOF } = this.#t\n      this.#t.onEOF = async () => {\n        this.#t.onEOF = onEOF\n        // get out of the dir before anything else, in case\n        // someone wants to delete it.\n        proc?.chdir?.(back)\n        await onEOF()\n      }\n    }\n    proc?.chdir?.(dir)\n  }\n}\n\n/**\n * plugin method that instantiates an {@link @tapjs/chdir!Chdir}\n */\nexport const plugin: TapPlugin<Chdir> = t => new Chdir(t)\n"]}